# 3.1 边缘和导数 Edges and Derivatives

> 图像中灰度变化较大的非连续像素可以看做是边缘，边缘是最为重要的图像特征之一，在目标检测、追踪、识别中都必不可少的使用到了边缘，人类视觉系统也对边缘信息非常敏感。如果在图像中检测到边缘并对其进行定位，那么对后续的算法将起到至关重要的作用。**灰度的突然变化会在一阶导数中引起波峰或者波谷，或者在二阶导数中等效的引起零交叉。**  
> 在下面我们介绍一些边缘检测的方法。  
>   
> 链接：https://www.jianshu.com/p/2ac784fd22fc  

* 什么是边缘？
	* 像图像中两部分的强度的变化（significant change in intensity）
	* 如下图（intensity graph)
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.36.00.png)

## 1. 一阶导数边缘滤波器 First-Derivative Edge Filters
> 对于上图来说，最陡峭的点在中间  
### 1D kernel
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.45.04.png)
[-1,0,1] 这是一个 First-Derivative Edge Filter，想象你站在中央像素，往左看，也往右看，你就能看出你是否在一个山丘的一面。所以有了这个kernel，这个中央像素的slope就是右边的强度减去左边的强度

### 2D kernel
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.46.36.png)
直接把行复制，就得到了这种最原始的边缘检测算子，称为Prewitt算子
#### 1.1 Prewitt Filter
	![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.47.34.png)

#### 1.2 Sobel Filter
	也可以使用同样的方法加上 加权平均，就得到了Sobel算子
	![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.49.19.png)

#### Roberts Filter
	还有一个简单的2x2的滤波器，叫做Roberts Filter，只不过不怎么用得到
	![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.50.09.png)

### Sobel Filter
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.24.58.png)
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2011.56.41.png)
	* 它有在y方向上求平均，并在X方向上找到边缘的效果
	* 这里叫作Sx,因为它可以找到X方向上的边缘。当我们说X Direction，就表示它能找到X方向上的梯度。
	* 和图片中的垂直边缘有关
	* Sobel算子具有对原始图像平滑的效果

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.01.35.png)
Sy
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.21.29.png)

> 我们要如何知道它有smoothing和 edge finding的作用，如果查看它的列的话？  
> 如果我们查看列（[1,2,1]），也就是加权平均；  
> 然后再拿（[-1,0,1]）向量，作用是可以找到边缘  
> 如果卷积这两个向量，我们就可以得到原始的 3x3的矩阵  

> 这样做的好处是：  
> 1. 我们可以用其中一个向量来控制图像，然后我们可以用其中一个向量来覆盖所有的图像，再用另一个向量来控制结果，而不是用3X3内核来进行卷积  
> 2. 它更有效率，因为用这个3x3的卷积核，它需要6个乘法和加法，但使用这些1D Kernel，只需要5个运算  

高斯平滑核 Gaussian smoothing kernel也是可分离的(separable)
因此，与其说使用一个完整的3x3的kernel，需要9个乘法和加法。可以用6个一维核来完成。当你进入更大的内核时，这会更省时间

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.09.04.png)

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.14.17.png)
	* Sx找垂直边缘
	e.g. 还是小猫的图像，要找到此图的垂直边缘，可以用Sobel Kernel， Sx
	用Sx就是要找到X方向上的梯度，对应垂直边缘

	* Sy找水平边缘

	* 边缘强度 Edge Strength
		* (Ix^2+Iy^2)^1/2

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.21.49.png)
这看起来不错。你可以说它已经找到了边缘。但是，如果你看一下沿线的强度 你可以看到，在这条线上都有梯度。你可以看到 例如，在小猫和地板上的变化，以及在线球上有很多峰值。绳子的球中有很多峰值。所以Sobel本身并不能达到我们想要的效果。

我们可以从上面的边缘中计算出magnitude，也可以计算出向量的角度。但请注意，这给我们提供的是边缘的法线(垂直于平面或曲面)，所以边缘本身是与该梯度角度成90度的


## 2. 二阶导数边缘滤波器 Second-Derivative Edge Filters
图1：图像的Intensity变化
图2：Slope的一阶导数，梯度最大的地方就是边缘
图3：二阶导数
> 但是我们如何找到最大的梯度的最大值？我们如何找到梯度的最大值在哪里？  
> 我们可以再次进行微分，我们在分级图中得到这个。你可以看到，斜率开始是零，然后开始增加，当它到达最大时，又是一个零斜率。所以第一个导数的最大值与第二个导数的零交叉点相对应  
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.32.54.png)


### 2.1 Laplacian 拉普拉斯算子
	* 通过计算二阶导数来度量图像的曲率
	* 二阶导数在变化最大处（即边缘处）为零，由此可以通过二阶导数提取边缘

	* Laplacian：标量算子
	* 高斯之差，高斯拉普拉斯：包括高斯平滑器
	* 假边缘：每一个梯度的高峰/低谷都有一个零点交叉，而不仅仅是大的高峰。
	* 没有告诉我们边缘的方向（标量运算符）
	* 倾向于创造边缘的封闭循环（"一盘面条 "的效果）

	* 需要考虑平滑和噪音问题 **smoothing** and **noise**
	* 需要考虑 **scale**
	* 需要考虑 edge **detection**

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2014.04.00.png)

![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2014.05.34.png)
![](3.1%20%E8%BE%B9%E7%BC%98%E5%92%8C%E5%AF%BC%E6%95%B0%20Edges%20and%20Derivatives/%E6%88%AA%E5%B1%8F2021-04-27%2012.37.52.png)
> 拉普拉斯值从正数过渡到负数（反之亦然），这个位置很可能就是边缘，可以对拉普拉斯图像阈值化，得到正数与负数之间的分割区域，这两个区域之间的边界就是过零点。因此，可以用形态学运算来提取这些轮廓，也就是用拉普拉斯图像减去膨胀后的图像。  
>   
> 拉普拉斯过零点方法检测了所有的边缘，不能区分强边缘和弱边缘，拉普拉斯算子对噪声非常敏感，有些边缘是由于压缩失真造成的  
>   
> 在实际检测边缘时，需要把拉普拉斯算子与其他算子结合使用  

	* Laplace算子应用：
	通过从图像中减去它的拉普拉斯图像，可以增强图像的对比度


